<!doctype html>
<html lang="en">
    <head>
        <title>SweetBakery Admin</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />

        <!--jQuery-->
        <script src="https://code.jquery.com/jquery-4.0.0.js" integrity="sha256-9fsHeVnKBvqh3FB2HYu7g2xseAZ5MlN6Kz/qnkASV8U=" crossorigin="anonymous"></script>

        <!-- Google materials and fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>

        <link rel="stylesheet" href="assets/styles/AdminStyles.css">
    </head>

    <body style="background-color: #f8f6f6;">
        <header class="bg-white">
            <!-- place navbar here -->
             <nav class="navbar navbar-expand-lg bg-body-tertiary bg-white" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);">
                <div class="container-fluid px-5">
                    <div class="logo d-flex align-items-center gap-2">
                        <div class="icon-bakery p-2 rounded-lg text-white">
                            <span class="material-symbols-outlined text-2xl">bakery_dining</span>
                        </div>
                        <a class="navbar-brand mb-0 h1" href="#">SweetBakery Admin</a>
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link" href="index.html">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Inventory</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Orders</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Costumers</a>
                            </li>
                        </ul>

                        <div class="d-flex align-items-center gap-3">
                            <!-- Search -->
                            <div class="position-relative d-none d-sm-block">
                                <span class="material-symbols-outlined search-icon">search</span>
                                <input
                                    type="text"
                                    class="form-control search-input"
                                    placeholder="Search inventory..."
                                />
                            </div>
                            <!-- Notifications button -->
                            <button class="btn btn-light rounded-circle text-secondary d-none d-sm-block">
                                <span class="material-symbols-outlined">notifications</span>
                            </button>
                            <!-- Avatar -->
                            <div class="avatar">
                                <img
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuAhYzjmjHM_TEwjvUv0BAF1w-kFI6IjvdZGHWTIEITvyp0XNbTj6sPzwAn3LMhqImrqGu31s_lt-g2LPllQV5DqL2wu4uZrMcUd6rtijCx-VFpHYHVD6jPrSJHeCq4fTtDdcnogSTGw9v4WF-RVSDe1sAegix0VGreJ_69QmaDvu2DXgj4wZfxBaYCinJwIKsQPzMIrkVvu0aIZefvRRlGxGF9UZEyu-KySG86-Dr9i5AQLcHJVOyVG_KPcEZS0TgYmTg9GckJ_7bo"
                                alt="Admin user profile avatar"
                                />
                            </div>

                        </div>
                    </div>
                </div>
            </nav>
        </header>
        
        <main>
            <div class="container my-4">
                <!-- Breadcrumb -->
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Admin</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Inventory Management</li>
                    </ol>
                </nav>

                <!-- Header Section -->
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
                    <div>
                        <h2 class="fw-bold mb-1">Inventory Management</h2>
                        <p class="text-secondary mb-0">Manage your pastry catalog and expand your menu.</p>
                    </div>
                    <button class="btn btn-outline-secondary d-flex align-items-center gap-2">
                        <span class="material-symbols-outlined">file_download</span>
                        Export
                    </button>
                </div>

                <!-- Add Product Card -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white fw-semibold d-flex align-items-center gap-2">
                        <span class="material-symbols-outlined text-danger">add_circle</span>
                        Add New Product
                    </div>
                    <div class="card-body">
                        <form class="row g-3 align-items-end">
                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">Product Name</label>
                                <input type="text" id="addName" class="form-control custom-input" placeholder="Chocolate Croissant">
                                <small class="text-danger error-message" style="display:none;">This field is required</small>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">Category</label>
                                <select id="addCategory" class="form-select custom-input"></select>
                                <small class="text-danger error-message" style="display:none;">This field is required</small>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">Price ($)</label>
                                <input type="text" id="addPrice" class="form-control custom-input" placeholder="0.00">
                                <small class="text-danger error-message" style="display:none;">This field is required</small>
                            </div>

                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">Image URL</label>
                                <input type="text" id="addImage" class="form-control custom-input" placeholder="https://image-url.com">
                                <small class="text-danger error-message" style="display:none;">This field is required</small>
                            </div>

                            <div class="col-12 text-end">
                                <button type="submit" class="btn btn-primary px-4 d-inline-flex align-items-center gap-2">
                                    <span class="material-symbols-outlined">save</span>
                                    Save Product
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <span class="fw-semibold">Current Inventory</span>
                        <input type="text" class="form-control form-control-sm table-filter" placeholder="Filter table...">
                    </div>

                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead class="table-light text-uppercase small">
                                <tr>
                                    <th>Thumbnail</th>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th class="text-end">Price</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-body"></tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="card-footer bg-white d-flex justify-content-between align-items-center">
                        <small class="text-secondary">Showing 3 of 24 products</small>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" disabled>Previous</button>
                            <button class="btn btn-sm btn-outline-secondary">Next</button>
                        </div>
                    </div>
                </div>

            </div>
        </main>
        <footer>
            <!-- place footer here -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form id="editForm">

                        <input type="hidden" id="editId">

                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" id="editName" class="form-control">
                            <small class="text-danger error-message" style="display:none;">This field is required</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Price</label>
                            <input type="number" id="editPrice" class="form-control">
                            <small class="text-danger error-message" style="display:none;">This field is required</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select id="editCategory" class="form-select custom-input"></select>
                            <small class="text-danger error-message" style="display:none;">This field is required</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="text" id="editImage" class="form-control">
                            <small class="text-danger error-message" style="display:none;">This field is required</small>
                        </div>

                    </form>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" id="saveChanges">Save Changes</button>
                </div>

                </div>
            </div>
        </div>


    <script>
        const apiUrl = "https://698a9f596c6f9ebe57ba34be.mockapi.io/api/pasteles/cakes";

        function validateField(field) {
            var isValid = true;
            var value = field.val().trim();

            if (field.is("select")) {
                if (value === "") {
                    field.addClass("is-invalid");
                    field.next(".error-message").fadeIn();
                    isValid = false;
                } else {
                    field.removeClass("is-invalid");
                    field.next(".error-message").fadeOut();
                }
                return isValid;
            }

            if (value === "") {
                field.addClass("is-invalid");
                field.next(".error-message").fadeIn();
                isValid = false;
            } else {
                field.removeClass("is-invalid");
                field.next(".error-message").fadeOut();
            }

            return isValid;
        }

        $(document).ready(function () {

            const itemsPerPage = 10;
            var currentPage = 1;
            var allData = [];

            const prevBtn = $(".btn-outline-secondary:contains('Previous')");
            const nextBtn = $(".btn-outline-secondary:contains('Next')");
            const infoText = $(".card-footer small");

            function renderTable() {
                $("#inventory-body").empty();

                const totalItems = allData.length;
                const totalPages = Math.ceil(totalItems / itemsPerPage);

                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;

                const pageData = allData.slice(start, end);

                pageData.forEach(function (cake) {
                    var row = `
                        <tr>
                            <td>
                                <img src="${cake.imageUrl}" class="product-img" width="60">
                            </td>

                            <td class="fw-semibold">${cake.name}</td>

                            <td>
                                <span class="badge bg-primary-subtle text-primary">
                                    ${cake.category}
                                </span>
                            </td>

                            <td class="text-end">$${parseFloat(cake.price).toFixed(2)}</td>

                            <td class="text-center">
                                <button class="btn btn-sm btn-light action-btn edit-btn" data-id="${cake.id}">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>

                                <button class="btn btn-sm btn-light action-btn text-danger delete-btn" data-id="${cake.id}">
                                    <span class="material-symbols-outlined">delete</span>
                                </button>
                            </td>
                        </tr>
                    `;
                    $("#inventory-body").append(row);
                });

                infoText.text(`Showing ${pageData.length} of ${totalItems} products`); //update bttn

                prevBtn.prop("disabled", currentPage === 1); // enable - disable bttn
                nextBtn.prop("disabled", currentPage === totalPages);
            }

            $.ajax({
                url: apiUrl,
                method: "GET",
                success: function (data) {
                    allData = data;
                    const categories = [...new Set(data.map(item => item.category))];
                    // clean selects
                    $("#addCategory").empty();
                    $("#editCategory").empty();

                    // add an default option
                    $("#addCategory").append(`<option value="">Select category</option>`);
                    $("#editCategory").append(`<option value="">Select category</option>`);

                    // add categories uniques
                    categories.forEach(function (cat) {
                        $("#addCategory").append(`<option value="${cat}">${cat}</option>`);
                        $("#editCategory").append(`<option value="${cat}">${cat}</option>`);
                    });
                    renderTable();
                },
                error: function () {
                    alert("Error loading products.");
                }
            });

            // Next button
            nextBtn.click(function () {
                const totalPages = Math.ceil(allData.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            });

            // Previous bttn
            prevBtn.click(function () {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            });

        });

        // delete for each cake
        $(document).on("click", ".delete-btn", function () {

            var id = $(this).data("id");

            if (confirm("Are you sure you want to delete this product?")) {

                $.ajax({
                    url: apiUrl + "/" + id,
                    method: "DELETE",
                    success: function () {
                        location.reload();
                    }
                });
            }
        });

        // edit for each cake (open mod)
        $(document).on("click", ".edit-btn", function () {
            var id = $(this).data("id");
            $.ajax({
                url: apiUrl + "/" + id,
                method: "GET",
                success: function (cake) {

                    $("#editId").val(cake.id);
                    $("#editName").val(cake.name);
                    $("#editPrice").val(cake.price);
                    $("#editCategory").val(cake.category);
                    $("#editImage").val(cake.imageUrl);

                    var modal = new bootstrap.Modal(document.getElementById('editModal'));
                    modal.show();
                }
            });

        });

        // save changes
        $("#saveChanges").click(function () {
            var isValid = true;

            const name = $("#editName");
            const price = $("#editPrice");
            const category = $("#editCategory");
            const image = $("#editImage");

            $("#editForm .error-message").hide();
            $("#editForm .form-control, #editForm .form-select").removeClass("is-invalid");

            if (!validateField(name)) isValid = false;
            if (!validateField(price)) isValid = false;
            if (!validateField(category)) isValid = false;
            if (!validateField(image)) isValid = false;

            if (isValid) {
                var id = $("#editId").val();

                var updatedCake = {
                    name: name.val(),
                    price: price.val(),
                    category: category.val(),
                    imageUrl: image.val()
                };

                $.ajax({
                    url: apiUrl + "/" + id,
                    method: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify(updatedCake),
                    success: function () {
                        location.reload();
                    }
                });
            }
        });

        // add product validation
        $("form").submit(function (e) {
            e.preventDefault();

            var isValid = true;

            const name = $("#addName");
            const price = $("#addPrice");
            const category = $("#addCategory");
            const image = $("#addImage");

            $(".error-message").hide();
            $(".custom-input").removeClass("is-invalid");

            if (!validateField(name)) isValid = false;
            if (!validateField(price)) isValid = false;
            if (!validateField(category)) isValid = false;
            if (!validateField(image)) isValid = false;

            if (isValid) {
                const newCake = {
                    name: name.val(),
                    price: price.val(),
                    category: category.val(),
                    imageUrl: image.val()
                };

                $.ajax({
                    url: apiUrl,
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(newCake),
                    success: function () {
                        location.reload();
                    }
                });
            }
        });

    </script>

        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
